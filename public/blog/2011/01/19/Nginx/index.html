
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>NGINX and Unicorn - RB Design</title>
  <meta name="author" content="R W Boyer">

  
  <meta name="description" content="So, we have all been reading about the wonders of new stuff to replace our old stuff. Well at least we have if we follow what is going on in the Ruby &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://code.rwboyer.com/blog/2011/01/19/Nginx">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="RB Design" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Bitter:400italic,400,700' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-28176403-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">RB Design</a></h1>
  
    <h2>A complete reset</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:code.rwboyer.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">NGINX and Unicorn</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-19T00:00:00-05:00" pubdate data-updated="true">Jan 19<span>th</span>, 2011</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>So, we have all been reading about the wonders of new stuff to replace our old stuff. Well at least we have if we follow what is going on in the Ruby world even a little bit. Specifically there has been <em>a lot</em> of hub-bub and controversy about NGINX over Apache and Unicorn over Mongrel with increasing frequency in the past year or a little longer.</p>

<p>At first the news was pretty lopsided. NGINIX is <em>WAY</em> faster than Apache and Unicorn is <em>WAY</em> better than Mongrel. Lately there has been a lot of blowback along the lines of <em>Hmmmm, not really</em> Apache/Passenger is fine and works great and has a <strong>BETTER</strong> scaling model. Granted a lot of that blowback has been generated by Passenger developers along with vague references to the <em>next version</em> but still&#8230; It was time to find out for myself. Up goes a bunch of test instances on both EC2 and Rackspace for some playing.</p>

<h2>Bottom Line and Disclaimers</h2>

<ul>
<li>I am not running either NGINX or Unicorn in production</li>
<li>All of my upfront conclusions are based on really small server instnaces</li>
<li>What I am looking at and care about may be <em>way</em> different than you care about.</li>
</ul>


<p>Okay, with that out of the way I can say that SSL processing in NGINX is way more better (read efficient) than it is on Apache. I cannot see how this could be a whole lot different for anybody unless they are doing somthing special with Apache and SSL termination, in which case you could do the same thing with NGINX. For me, I always terminate SSL in the webserver. Historically this has been far easier and less costly to scale than more specialized solutions that get very old very quick.</p>

<p>NGINX seems to use a lot less memory than Apache for the same connection load when nnly proxying and serving static content. Of course this could be way different if Apache or NGINX are doing way different jobs for you than the simple job I tested and normally use. This includes any heavy module use of any kind. Look before you leap. An example could be as simple as Apache having a way better rewrite module than NGINX - I have no idea&#8230; yet.</p>

<p>Bottom line. On a really small server instance I can proxy to almost as many app servers as I can imagine - amazing.</p>

<p>On to Unicorn. Unicorn is going to make my life a lot easier or at the very least, my servers a lot less complicated. With most of my experience over doing it with the queing / buffering at too many layers is a recipie for problems. Especially where there is no need for it. Of course you want to do it if whatever is on the other front-end is somehow the constraint and cannot stand to be held up for even a moment but if that thing (like a multi-threaded, multi-process, multi-connection webserver) is already doing that job quing requests is useless. It doesn&#8217;t make stuff go faster, or increase capacity. In every app I have ever seen, no matter what the underlying tech, doing this just exacerbates the <strong>pain</strong> when you run out of juice at the end of the line or obfuscates intermittent issues.</p>

<p>Having said that I am all for Unicorn&#8217;s request distribution mechanism. Screw the aledged thundering herd issue. You have to be an idiot if you have to scale that big and can&#8217;t avoid that with like more than one Unicorn, on maybe more than one socket. At the end of the day I can get rid of some of the sanity checking and automated bullshit clearing stuff that is running on my servers. Unicorn has a lot of features built in that make deployment/managemet pretty simple without a bunch of dispariate tools wired together at home. I&#8217;ll take that anyday. If I need some monitoring and control on top of that I will probably add BluePill but I am definitely rethinking my current overly complicated mess when I deploy Unicorn in production.</p>

<p>Oh you want some numbers? Okay but that will have to wait a tiny bit. I plan on doing some more formal analysis on both Rackspace and EC2 this week and over the weekend.</p>

<p>RB
:wq</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">R W Boyer</span></span>

      








  


<time datetime="2011-01-19T00:00:00-05:00" pubdate data-updated="true">Jan 19<span>th</span>, 2011</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://code.rwboyer.com/blog/2011/01/19/Nginx/" data-via="rwboyer" data-counturl="http://code.rwboyer.com/blog/2011/01/19/Nginx/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/01/19/Full-Circle/" title="Previous Post: Full Circle">&laquo; Full Circle</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/01/05/Another-Year/" title="next Post: Another Year">Another Year &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/01/06/wtf/">WTF</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/01/05/Another-Year/">Another Year</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/01/19/Nginx/">NGINX and Unicorn</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/01/19/Full-Circle/">Full Circle</a>
      </li>
    
      <li class="post">
        <a href="/blog/2010/11/20/Mumps/">Old Business Models Die Hard</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("rwboyer", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/rwboyer" class="twitter-follow-button" data-show-count="false">Follow @rwboyer</a>
  
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - R W Boyer -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'heroku-octopress';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://code.rwboyer.com/blog/2011/01/19/Nginx/';
        var disqus_url = 'http://code.rwboyer.com/blog/2011/01/19/Nginx/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
